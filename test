import tkinter as tk
from tkinter.ttk import Combobox
from tkinter import messagebox
import lib.DataTool as DT

listeUser = ["Selectionner un utilisateur"] + DT.InformationPersonnel(DT.dfc)
reservation = ""
presetReservation = """
------------Information client-----------

Nom: {}
Prenom: {}
Numero permis: {}

---------Information reservation---------

date de début de réservation: {}
date de fin de réservation: {}
id vehicle: {}
véhicule: {}
catégorie: {}
assurance: {}
prix: {}
"""


def valide(reservationInfo, app):
    msgboxText = """
           Réservation à supprimer : {}
           """.format(None)
    resp = messagebox.askokcancel(title="Voulez-vous annuler cette réservation ?", message=msgboxText)

    if resp == True:
        #DT.louer(DT.dfv, DT.dfc, num_permis, id, date_debut, date_fin, prix)
        app.destroy()
    else:
        app.destroy()

def reserv_page(master):
    """
    [Description]

    :param master: master se réfaire à la page parent
    :return:
    """

    app = tk.Toplevel(master)
    app.geometry('920x640+500+125')
    app.attributes("-toolwindow", 1)# Supprime les boutons Réduire/Agrandir
    app.transient(master)
    app.resizable(False, False)
    app.title("Réservation")
    
    def user_select(event):
        """
        [description]
        Fonction permettant de choisir la page à ouvrir parmi un menu déroulant

        :return:
        """

        global annul, listeUser

        # Obtenir l'élément sélectionné
        select = listeCombo1.get()
        print("Vous avez sélectionné : '", select, "'")
        type(select)

        #print(listeUser)
        if select != "Selectionner un utilisateur":
            selectedUser = select.split(" ")
            print(selectedUser)

            user = DT.aff_client(DT.dfc, selectedUser)

            annul = presetReservation.format(user[0], user[1], user[3], None, None, None, None, None, None, None, None)

            userInfo.delete("1.0", "end")
            userInfo.insert(tk.END, annul)
            return user[4]
        else:
            annul = ""
            userInfo.delete("1.0", "end")
            userInfo.insert(tk.END, presetReservation.format("", "", "", "", "", "", "", "", "", "", ""))
            return annul
        
    label = tk.LabelFrame(app, text="Sélectionnez l'utilisateur dont vous voulez annuler la réservation")
    label.place(relheight=1, relwidth=1)

    BtnValide = tk.Button(label, text='Valider', command=lambda: valide(annul, app))
    BtnValide.place(relx=0.3, rely=0.8, relheight=0.05, relwidth=0.4)

    listeCombo1 = Combobox(label, height=200, width=27, values=listeUser)
    listeCombo1.current(0)
    listeCombo1.place(relx=0.1, rely=0.1, relheight=0.05, relwidth=0.4)
    listeCombo1.bind("<<ComboboxSelected>>", user_select)
        
    userInfo = tk.Text(label)
    userInfo.insert(tk.END,presetReservation.format("", "", "", "", "", "", "", "", "", "", ""))
    userInfo.place(relx=0.5, rely=0.1, relheight=0.6, relwidth=0.4)
    
    # Combo Box Categorie voiture
    def type_vehicule():
        """
        [description]
        Fonction permettant de choisir le type de véhicule parmi un menu déroulant

        :return:
        """
        
        # Obtenir l'élément sélectionné
        select = listeCombo1.get()
        
        print("Vous avez sélectionné : '", select, "'")

        if select == "Type Tourisme [T]":
            labelGammeT = tk.LabelFrame(app, text="Gamme").place(
                relx=0.05, rely=0.045, relheight=0.1, relwidth=0.2)
            listeCategorie = ["SUV", "BERLINE", "MONOSPACE", "SPORTIVE", "ELECTRIQUE"]
            listeCombo1 = Combobox(labelGammeT, height=200, width=27, values=listeCategorie)
            listeCombo1.current(0)
            listeCombo1.place(relx=0.3, rely=0.6, relheight=0.05, relwidth=0.4)
            listeCombo1.bind("<<ComboboxSelected>>", type_vehicule)
    
            
            
            
            
        elif select == "Type Utilitaire  [U]":
            labelGammeU = tk.LabelFrame(app, text="Gamme").place(
                relx=0.05, rely=0.045, relheight=0.09, relwidth=0.2)
        else:
            print("ERROR: no Type fund")
    
    listeType = ["Type Tourisme [T]", "Type Utilitaire  [U]"]
    listeCombo1 = Combobox(app, height=200, width=27, values=listeType)
    listeCombo1.current(0)
    listeCombo1.place(relx=0.3, rely=0.6, relheight=0.05, relwidth=0.4)
    listeCombo1.bind("<<ComboboxSelected>>", type_vehicule)
    
    
    varDateDebut = tk.StringVar()
    tk.LabelFrame(app, text="Date de début").place(
        relx=0.1, rely=0.3, relheight=0.09, relwidth=0.2)
    tk.Entry(app, width=14, textvariable=varDateDebut).place(
        relx=0.06, rely=0.07, relheight=0.05, relwidth=0.18)

    varDateFin = tk.StringVar()
    tk.LabelFrame(app, text="Date de fins").place(
        relx=0.1, rely=0.4, relheight=0.09, relwidth=0.2)
    tk.Entry(app, width=14, textvariable=varDateFin).place(
        relx=0.06, rely=0.07, relheight=0.05, relwidth=0.18)
    
    radioValue = tk.IntVar() 
    radioOui = tk.Radiobutton(app, text='OUI',variable=radioValue, value="OUI").place(
        relx=0.1, rely=0.5, relheight=0.05, relwidth=0.4)
    radioNon = tk.Radiobutton(app, text='NON',variable=radioValue, value="NON").place(
        relx=0.2, rely=0.5, relheight=0.05, relwidth=0.4)
    
    labelRadio = tk.Label(app, textvariable=radioValue).place(
        relx=0.2, rely=0.5, relheight=0.05, relwidth=0.4)



    def grille_tarrifaires(self):
        MsgboxText = """
        {}
        """.format(DT.aff_tarifs())
        print(MsgboxText)
        messagebox.showinfo(title="Grille Tarrifaires", message=MsgboxText)

    def vehicules(self):
        MsgboxText = """
        {}
        """.format(0)
        print(MsgboxText)
        messagebox.showinfo(title="vehicules", message=MsgboxText)

    def clients(self):
        MsgboxText = """
        {}
        """.format(0)
        print(MsgboxText)
        messagebox.showinfo(title="clients", message=MsgboxText)


    """    tk.LabelFrame(app, text="Id Véhicule").place(
        relx=0.1, rely=0.21, relheight=0.09, relwidth=0.2)
    tk.Entry(app, width=14, textvariable=varIdVehi).place(
        relx=0.11, rely=0.235, relheight=0.05, relwidth=0.18) """



    def selecType(event):
        """
        [description]
        Fonction permettant de choisir la page à ouvrir parmi un menu déroulant

        :return:
        """

        global selecType

        id1 = 1
        id2 = 2
        id3 = 3

        # Obtenir l'élément sélectionné
        select = listeCombo1.get()
        print("Vous avez sélectionné : '", select, "'")

        if selecType == "U":
            reservType = presetVehicule.format("a","z","e","r","t","y", id1,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservType)
            return reservType

        elif selecType == "T":
            reservType = presetVehicule.format("a","z","e","r","t","y", id2,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservType)
            return reservType

        else:
            reservType = ""
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, presetVehicule.format("", "", "", "", "", "", "", "", "", "", ""))
            return reservType

    def selecMarque(event):
        """
        [description]
        Fonction permettant de choisir la page à ouvrir parmi un menu déroulant

        :return:
        """

        global selecMarque

        id1 = 1
        id2 = 2
        id3 = 3

        # Obtenir l'élément sélectionné
        select = listeCombo1.get()
        print("Vous avez sélectionné : '", select, "'")


        if selecMarque == "PEUGEOT":
            reservMarque = presetVehicule.format("a","z","e","r","t","y", id1,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservMarque)
            return reservMarque

        elif selecMarque == "FERRARI":
            reservMarque = presetVehicule.format("a","z","e","r","t","y", id2,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservMarque)
            return reservMarque

        elif selecMarque == "VOLKSWAGEN":
            reservMarque = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservMarque)
            return reservMarque

        elif selecMarque == "RENAULT":
            reservMarque = presetVehicule.format("a","z","e","r","t","y", id4,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservMarque)
            return reservMarque

        elif selecMarque == "MERCEDES":
            reservMarque = presetVehicule.format("a","z","e","r","t","y", id5,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservMarque)
            return reservMarque

        elif selecMarque == "PORSCHE":
            reservMarque = presetVehicule.format("a","z","e","r","t","y", id6,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservMarque)
            return reservMarque

        elif selecMarque == "AUDI":
            reservMarque = presetVehicule.format("a","z","e","r","t","y", id7,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservMarque)
            return reservMarque

        elif selecMarque == "TESLA":
            reservMarque = presetVehicule.format("a","z","e","r","t","y", id8,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservMarque)
            return reservMarque

        elif selecMarque == "IVECO":
            reservMarque = presetVehicule.format("a","z","e","r","t","y", id9,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservMarque)
            return reservMarque

        else:
            reservMarque = ""
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, presetVehicule.format("", "", "", "", "", "", "", "", "", "", ""))
            return reservMarque

    def selecGamme(event):
        """
        [description]
        Fonction permettant de choisir la page à ouvrir parmi un menu déroulant

        :return:
        """

        global selecGamme

        id1 = 1
        id2 = 2
        id3 = 3

        # Obtenir l'élément sélectionné
        select = listeCombo1.get()
        print("Vous avez sélectionné : '", select, "'")

        if selecGamme == "SUV":
            reservGamme = presetVehicule.format("a","z","e","r","t","y", id1,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservGamme)
            return reservGamme

        elif selecGamme == "BERLINE":
            reservGamme = presetVehicule.format("a","z","e","r","t","y", id2,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservGamme)
            return reservGamme

        elif selecGamme == "MONOSPACE":
            reservGamme = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservGamme)
            return reservGamme

        elif selecGamme == "SPORTIVE":
            reservGamme = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservGamme)
            return reservGamme

        elif selecGamme == "ELECTRIQUE":
            reservGamme = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservGamme)
            return reservGamme

        elif selecGamme == "BENNE":
            reservGamme = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservGamme)
            return reservGamme

        elif selecGamme == "3 A 5":
            reservGamme = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservGamme)
            return reservGamme

        elif selecGamme == "6 A 10":
            reservGamme = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservGamme)
            return reservGamme

        elif selecGamme == "11 A 15":
            reservGamme = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservGamme)
            return reservGamme

        elif selecGamme == "20 A 25":
            reservGamme = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservGamme)
            return reservGamme

        else:
            reservGamme = ""
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, presetVehicule.format("", "", "", "", "", "", "", "", "", "", ""))
            return reservGamme

    def selecModel(event):
        """
        [description]
        Fonction permettant de choisir la page à ouvrir parmi un menu déroulant

        :return:
        """

        global selec

        id1 = 1
        id2 = 2
        id3 = 3

        # Obtenir l'élément sélectionné
        select = listeCombo1.get()
        print("Vous avez sélectionné : '", select, "'")

        if select == "PEUGEOT":
            reserv = presetVehicule.format("a","z","e","r","t","y", id1,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reserv)
            return reserv

        elif select == "FERRARI":
            reservModel = presetVehicule.format("a","z","e","r","t","y", id2,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservModel)
            return reservModel

        elif select == "VOLKSWAGEN":
            reservModel = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservModel)
            return reservModel

        elif select == "RENAULT":
            reservModel = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservModel)
            return reservModel

        elif select == "MERCEDES":
            reservModel = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservModel)
            return reservModel

        elif select == "PORSCHE":
            reservModel = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservModel)
            return reservModel

        elif select == "AUDI":
            reservModel = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservModel)
            return reservModel

        elif select == "TESLA":
            reservModel = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservModel)
            return reservModel

        elif select == "IVECO":
            reservModel = presetVehicule.format("a","z","e","r","t","y", id3,"u","i","o","p")
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, reservModel)
            return reservModel

        else:
            reservModel = ""
            vehiculeInfo.delete("1.0", "end")
            vehiculeInfo.insert(tk.END, presetVehicule.format("", "", "", "", "", "", "", "", "", "", ""))
            return reservModel


    label = tk.LabelFrame(app, text="Sélectionnez l'utilisateur dont vous voulez reserver la réservation")
    label.place(relheight=1, relwidth=1)

    BtnValide = tk.Button(label, text='Valider', command=lambda: valide(reserv, app))
    BtnValide.place(relx=0.3, rely=0.8, relheight=0.05, relwidth=0.4)

    listeType = ["Type a selectionner", "U", "T"]
    listeCombo1 = Combobox(label, height=200, width=27, values=listeType)
    listeCombo1.current(0)
    listeCombo1.place(relx=0.3, rely=0.1, relheight=0.05, relwidth=0.4)
    listeCombo1.bind("<<ComboboxSelected>>", selecType)

    listeMarque = ["Marque a selectionner", "PEUGEOT", "FERRARI", "VOLKSWAGEN", "RENAULT", "MERCEDES", "PORSCHE", "AUDI", "TESLA", "IVECO"]
    listeCombo2 = Combobox(label, height=200, width=27, values=listeMarque)
    listeCombo2.current(0)
    listeCombo2.place(relx=0.3, rely=0.15, relheight=0.05, relwidth=0.4)
    listeCombo2.bind("<<ComboboxSelected>>", selecMarque)

    listeModel = ["Model a selectionner", "MONOSPACE", "SUV", "BERLIN", "SPORTIVE", "ELECTRIQUE", "3 A 5L", "6 A 10L", "11 A 15L", "20 A 25L", "BENNE"]
    listeCombo3 = Combobox(label, height=200, width=27, values=listeModel)
    listeCombo3.current(0)
    listeCombo3.place(relx=0.3, rely=0.2, relheight=0.05, relwidth=0.4)
    listeCombo3.bind("<<ComboboxSelected>>", selecModel)

    listeGamme = ["Gamme a selectionner", "MONOSPACE", "SUV", "BERLIN", "SPORTIVE", "ELECTRIQUE", "3 A 5L", "6 A 10L", "11 A 15L", "20 A 25L", "BENNE"]
    listeCombo4 = Combobox(label, height=200, width=27, values=listeGamme)
    listeCombo4.current(0)
    listeCombo4.place(relx=0.3, rely=0.25, relheight=0.05, relwidth=0.4)
    listeCombo4.bind("<<ComboboxSelected>>", selecGamme)

    listeCarbu = ["Carburant a selectionner", "ELECTRIQUE", "DIESEL", "ESSENCE"]
    listeCombo5 = Combobox(label, height=200, width=27, values=listeCarbu)
    listeCombo5.current(0)
    listeCombo5.place(relx=0.3, rely=0.3, relheight=0.05, relwidth=0.4)
    listeCombo5.bind("<<ComboboxSelected>>", selecCarbu)

    vehiculeInfo = tk.Text(label)
    vehiculeInfo.insert(tk.END,presetVehicule.format("", "", "", "", "", "", "", "", "", "", ""))
    vehiculeInfo.place(relx=0.3, rely=0.15, relheight=0.6, relwidth=0.4)